<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">


    <bean name="findAllEstoque" class="java.lang.String">
        <constructor-arg>
            <value>
                SELECT ID, ID_FORNECEDOR, DATA_COMPRA, DATA_ATUALIZACAO,
                PRECO_COMPRA, OBSERVACAO,
                (SELECT COUNT(ID) FROM ESTOQUE_ITEM EP WHERE EP.ID_ESTOQUE = E.ID
                AND EP.INVALIDO = 0
                AND EP.ID NOT IN  (SELECT ID_ESTOQUE_ITEM
                FROM BAIXA_ESTOQUE BE WHERE BE.ID_ESTOQUE_ITEM = EP.ID) ) AS QUANTIDADE
                FROM ESTOQUE E
            </value>
        </constructor-arg>
    </bean>

    <bean name="findAllProduto" class="java.lang.String">
        <constructor-arg>
            <value>
                SELECT P.ID, P.DESCRICAO, TP.DESCRICAO AS NOME_TIPO_PRODUTO, P.PESO, P.HEXA_COR, P.NOME_COR,
                P.ID_TIPO_PRODUTO, P.IMG_DESTAQUE, P.IMG_PREVIEW, P.REFERENCIA,
                (SELECT PRECO
                FROM TABELA_PRECO TP
                WHERE TP.ID_PRODUTO = P.ID AND TP.DATA_VIGENCIA =
                (SELECT MAX(DATA_VIGENCIA) FROM TABELA_PRECO TTP WHERE TTP.ID_PRODUTO = P.ID
                AND DATA_VIGENCIA &lt;= sysdate()) LIMIT 1) AS PRECO
                FROM PRODUTO P
                JOIN TIPO_PRODUTO TP ON TP.ID = P.ID_TIPO_PRODUTO
            </value>
        </constructor-arg>
    </bean>

    <bean name="findTabelaPrecoAtualByProduto" class="java.lang.String">
        <constructor-arg>
            <value>
                SELECT ID, ID_PRODUTO, DATA_VIGENCIA, PRECO, DESCRICAO
                FROM TABELA_PRECO TP
                WHERE TP.ID_PRODUTO = :id AND TP.DATA_VIGENCIA =
                (SELECT MAX(DATA_VIGENCIA) FROM TABELA_PRECO TTP WHERE TTP.ID_PRODUTO = :id
                AND DATA_VIGENCIA &lt;= sysdate()) LIMIT 1
            </value>
        </constructor-arg>
    </bean>


    <bean name="findProdutoEmEstoque" class="java.lang.String">
        <constructor-arg>
            <value>
                SELECT P.ID AS ID_PRODUTO, P.REFERENCIA, P.DESCRICAO AS NOME_PRODUTO,
                TP.DESCRICAO AS TIPO_PRODUTO,
                (SELECT COUNT(ID) FROM ESTOQUE_ITEM EI WHERE EI.ID_PRODUTO = P.ID
                    AND EI.INVALIDO = 0
                    AND EI.ID NOT IN  (SELECT BE.ID_ESTOQUE_ITEM
                    FROM BAIXA_ESTOQUE BE WHERE BE.ID_ESTOQUE_ITEM = EI.ID)
                ) AS QUANTIDADE
                FROM PRODUTO P
                JOIN TIPO_PRODUTO TP ON TP.ID = P.ID_TIPO_PRODUTO
            </value>
        </constructor-arg>
    </bean>

</beans>
